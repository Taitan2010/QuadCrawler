<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="description" content="" />
<meta name="keywords" content="" />
<meta name="GENERATOR" content="JustSystems Homepage Builder Version 18.0.1.0 for Windows" />
<link rel="stylesheet" href="css/common.css" type="text/css" />
<!-- <script type="text/javascript" src="js/jquery.js"></script> -->
<!-- <script type="text/javascript" src="js/common.js"></script> -->
<title>そーたメイ - familyday</title>
</head>
<body id="hpb-template-01-24-01">
<div id="top">
  <div id="hpb-header">
    <h1><a href="index.html">そーたとメイの工作 (sohtaMei)</a></h1>
  </div><!-- /#hpb-header -->

  <!-- navi -->
  <div id="hpb-nav">
    <ul>
      <li><a href="index.html">New</a></li>
      <li><a href="usb2bt.html">USB2BT</a></li>
      <li><a href="familyday.html">つくるっち</a></li>
      <li><a href="bitclock.html">BitClock</a></li>
      <li><a href="familyday_event.html">イベント出展</a></li>
      <li><a href="http://sohta02.bbs.fc2.com/" style="color : #ffffff;background-color : #9c6565;">BBS</a></li>
      <li><a href="miscellaneous.html">スタッフ他</a></li>
    </ul>
  </div>
  <!-- /#hpb-nav -->
  <!-- navi end -->
  <div id="contents">
    <div id="main">
      <h2>クアッドクローラー プログラミング</h2>

      <ul>
        <li><a href="#programming1">「つくるっち」からロボットを操作する</a></li>
        <li><a href="#remocon">リモコンを押したときブザーを鳴らすプログラムを作る</a></li>
        <li><a href="#burn">自分のプログラムをロボットに書き込む</a></li>
        <li><a href="#robot">クアッドクローラーのプログラムを作る</a></li>
        <li><a href="#robot2">ロボットを歩かせる</a></li>
        <li><a href="#sample">サンプルプログラム</a></li>
        <li><a href="#robot_normal">「最初のプログラム」の説明</a></li>
        <li><a href="#arduinoAPI">Arduino API</a></li>
      </ul>

      <h4><a name="programming1" id="programming1">「つくるっち」からロボットを操作する</a></h4>
      <p>　　<b>「つくるっち」でロボットを操作してみます。</b></p>
      <ul>
        <li><img src="images/image32.png" width="184" height="25" border="0" align="top" />のように表示されているか確認し、表示されてないときは<a href="familyday_app.html#connecting">PC通信モードに設定</a>を実行して下さい。</li>
        <li><img src="images/image131.png" width="81" height="27" border="0" align="top" />を押すとロボットのブザーが鳴ります。</li>
        <li><img src="images/image111.png" width="118" height="32" border="0" align="top" /> を押すとロボットが前に進みます。<img src="images/image121.png" width="55" height="30" border="0" align="top" />を押すと止まります。</li>
      </ul>

      <h4><a name="remocon" id="remocon">リモコンを押したときブザーを鳴らすプログラムを作る</a></h4>
      <p><b>　　リモコンのボタンを押したときブザーを鳴らすプログラムを作ります。</b></p>
      <ol>
        <li>図の通り<img src="images/image171.png" width="114" height="19" border="0" align="middle" /> - <img src="images/image221.png" width="91" height="36" border="0" align="middle" />を置く。<br />
        <img src="images/image25.png" width="381" height="204" border="0" /><br />
        </li>
        <li>図の通り<img src="images/image141.png" width="113" height="23" border="0" align="middle" /> - <img src="images/image151.png" width="87" height="48" border="0" align="middle" /> を置く、<img src="images/image161.png" width="93" height="51" border="0" align="middle" />を置く。<br />
        <img src="images/image27.png" width="424" height="361" border="0" /><br />        </li>
        <li><img src="images/image171.png" width="114" height="19" border="0" align="middle" /> - <img src="images/image181.png" width="151" height="23" border="0" align="middle" />を置く、<img src="images/image19.png" width="80" height="27" border="0" align="middle" />を置く。<br />
        <img src="images/image281.png" width="509" height="329" border="0" />
        <br />
        </li>
        <li>ブロックの端をクリックしてブロックのまわりが黄色い状態にします。この状態でロボットに向けリモコンのボタンを押すとブザーが鳴ります。<br />
        <img src="images/image9.png" width="530" height="197" border="0" /></li>
      </ol>

      <h4><a name="burn" id="burn">自分のプログラムをロボットに書き込む</a></h4>
      <ul style="list-style-type : none">
        <li>自分で作ったプログラムはそのままでは「つくるっち」がないと動作しませんが、自分のプログラムをロボットに書き込むとパソコンや「つくるっち」なしでプログラムを動かすことが出来ます。</li>
        <li>[Arduino]をクリック、[Arduinoにアップロード]を選択。プログラム書き込みには30秒くらいかかります、「アップロード中」は「閉じる」を押さないで下さい。</li>
      </ul>
      <p><img src="images/image312.png" width="803" height="211" border="0" /></p>
      <ul style="list-style-type : none">
        <li>「つくるっち」でプログラムを編集するときはもう一度<a href="#connecting">「PC通信モードに設定」</a>して下さい。</li>
      </ul>

      <h4><a name="robot" id="robot">クアッドクローラーのプログラムを作る</a></h4>
      <p><b>　　　標準リモコンでクアッドクローラーを動かすプログラムを作ります。</b></p>
      <ul style="list-style-type : none">
        <li><img src="images/image32.png" width="184" height="25" border="0" align="top" />のように表示されているか確認して下さい。</li>
        <li>下の図のとおり、クアッドクローラーのプログラムを作ってみて下さい。プログラムのどこかをクリックするとプログラムを動かすことができます。</li>
        <li><a href="#burn">「自分のプログラムを書き込む」</a>とUSBケーブルなしで動きます。</li>
        <li><img src="images/image33.png" width="421" height="440" border="0" /></li>
      </ul>

      <h4><a name="robot2" id="robot2">ロボットを歩かせる</a></h4>
      <p>　　<b>自動で歩く<img src="images/image34.png" width="115" height="27" border="0" align="middle" />の代わりに１歩ずつ歩くプログラムを作ります。</b><br />
      　　<b>ロボットがどうやって歩くのか確認します。</b></p>
      <p><font color="#ff0000">　　※注意：実行中は停止していても電池を消費します（赤LEDが点滅します）。<img src="images/image121.png" width="55" height="30" border="0" align="middle" />でサーボを止めて下さい。</font></p>
      <ul>
        <li><img src="images/image32.png" width="184" height="25" border="0" align="top" />のように表示されているか確認して下さい。</li>
        <li><b>前進</b><br />
        4つの状態で１周期です。ブロックをクリックすると１周期歩きます。<br />
        <img src="images/image35.png" width="600" height="807" border="0" />
        <br />
        <img src="images/image1.gif" width="449" height="224" border="0" /></li>
        <li><b>後進</b><br />
        <img src="images/image391.png" width="599" height="799" border="0" /></li>
        <li><b>旋回(時計回り)</b><br />
        <img src="images/image36.png" width="600" height="822" border="0" /></li>
        <li><b>旋回（反時計回り）</b><br />
        <img src="images/image38.png" width="605" height="804" border="0" />
        <br />
        </li>
      </ul>

      <h4><a name="sample" id="sample">サンプルプログラム</a></h4>
      <ul style="list-style-type : none">
        <li>「つくるっち」には４つのサンプルプログラムが入ってます。[プログラム] - [開く] で開いてください。</li>
        <li>
        <table border="1">
        <tbody>
          <tr>
              <td align="center" bgcolor="#ffff80">ファイル名</td>
              <td align="center" bgcolor="#ffff80">説明</td>
            </tr>
          <tr>
            <td>アナログクアッド.sb2</td>
            <td>アナログリモコンでロボットを操作</td>
          </tr>
          <tr>
            <td>アナログクアッドブロック.sb2</td>
            <td>アナログリモコンでロボットを操作（ブロック使用）</td>
          </tr>
          <tr>
            <td>デジタルクアッド.sb2</td>
            <td>標準リモコンでロボットを操作</td>
          </tr>
          <tr>
            <td>デジタルクアッドブロック.sb2</td>
            <td>標準リモコンでロボットを操作（ブロック使用）</td>
          </tr>
        </tbody>
      </table>
        </li>
      </ul>

      <h4><a name="robot_normal" id="robot_normal">「最初のプログラム」の説明</a></h4>
      <ul style="list-style-type : none">
        <li>「最初のプログラム」 は ext/libraries/QuadCrawler/robot_normal/robot_normal.ino にあります。</li>
        <li>　<a href="images/QuadCrawler.robot_normal.ino">robot_normal.ino</a></li>
        <li>サンプルプログラム （*.sb2） の機能に加えて「SW4による初期姿勢」「超音波センサ」「アナログリモコン D を押しながらの動作」に対応してます。</li>
      </ul>
      <ul>
        <li>初期化処理<br />
        quadCrawler_xxはロボットとLEDの制御、remoconRobo_xxは標準リモコンとアナログリモコンの処理です。</li>
      </ul>
      <pre>
void setup() {
  remoconRobo_init();
  quadCrawler_init();
  quadCrawler_colorWipe(COLOR_PURPLE);
  quadCrawler_beep(100);

  Serial.begin(115200);
  Serial.println(&quot;Normal: &quot; mVersion);
}</pre>
      <ul>
        <li>リモコン処理<br />
        標準リモコン、アナログリモコンを受信し、キーコードに従ってロボットを動かす。</li>
      </ul>
      <pre>
static uint8_t lastkey = 0;
static uint8_t originAdj = 0;
static uint8_t lastSw4 = 1;

void loop() {
  #define A_DOWN_OFFSET  0x10
  remoconRobo_checkRemoteUpdated(0);                       // リモコンコード受信
  struct remoconData rData = remoconRobo_getRemoteData();  // 受信したリモコンコード取得
  switch(rData.keys) {
  case BUTTON_A_XY:                                        // アナログリモコン JOYSTICK操作のとき
    rData.keys = rData.xyKeys;
    break;
  case BUTTON_A_DOWN:
    rData.keys = rData.xyKeys + A_DOWN_OFFSET;             // アナログリモコン D ボタン押し
    break;
  }

  if(rData.keys != lastkey) {
    lastkey = rData.keys;
    switch(rData.keys) {
      case BUTTON_MENU:             // MENUボタン : ブザー3秒
        quadCrawler_beep(3000);
        break;
      case BUTTON_0:                // 0ボタン : LEDレインボー
        quadCrawler_beep(50);
        for (int n = 0; n &lt; 5; n++) {
          quadCrawler_rainbow(5);
        }
        break;

      case XY_UP:                  // 上ボタン : 前進
      case BUTTON_UP:
        quadCrawler_colorWipe(COLOR_BLUE);
        quadCrawler_Walk(quadCrawler_fast, fw);
        break;
      ～ 省略 ～
      default:                    // ボタンを離したとき : 停止
        quadCrawler_colorWipe(COLOR_PURPLE);
        quadCrawler_Walk(quadCrawler_fast, stop);
        break;
    }
  }</pre>
      <ul>
        <li>SW4を押したとき初期姿勢にする (組み立て用)</li>
      </ul>
      <pre>
  uint8_t sw4 = digitalRead(Sw4);
  if(lastSw4!=sw4 &amp;&amp; sw4==0) {
    if(!originAdj) {
      quadCrawler_colorWipe(COLOR_RED);
      quadCrawler_setPose4(POSE_NEUTRAL, POSE_NEUTRAL, POSE_NEUTRAL, POSE_NEUTRAL, POSE_NEUTRAL, POSE_NEUTRAL, POSE_NEUTRAL, POSE_NEUTRAL);
    } else {
      quadCrawler_colorWipe(COLOR_PURPLE);
      quadCrawler_Walk(quadCrawler_fast, stop);
    }
    originAdj = !originAdj;
  } else if(originAdj &amp;&amp; !quadCrawler_checkServoON()) {
    quadCrawler_colorWipe(COLOR_PURPLE);
    originAdj = 0;
  }
  lastSw4 = sw4;</pre>
      <ul>
        <li>歩行などのモーション処理、経過時間に応じてサーボモーターを制御する。</li>
      </ul>
      <pre>
  quadCrawler_servoLoop();
  if(rData.xyLevel &gt;= 10) {              // アナログリモコンのJOYSTICK操作のとき速度設定
    quadCrawler_setSpeed(25000 / rData.xyLevel);
  }</pre>
      <ul>
        <li>超音波センサで障害物を検出したときブザーを鳴らす</li>
      </ul>
      <pre>
  double sonner_val;
  sonner_val = quadCrawler_getSonner();
  //Serial.println(sonner_val);
  if (sonner_val &lt; 8){
    quadCrawler_beep(sonner_val * 10);
    delay(sonner_val * 10);
  }
  else {
    delay(50);
  }
}</pre>
      <h4><a name="arduinoAPI" id="arduinoAPI">Arduino API</a></h4>
      <p>　　Arduino用ライブラリはext/arduinoLib/quadCrawlerLibにあります。</p>
      <ul>
        <li><a href="images/quadCrawler.h">quadCrawler.h</a><br />ロボットとLEDの制御<br />
        <table border="1">
          <tbody>
            <tr>
              <td>void quadCrawler_init(void);</td>
              <td>初期化処理、setup()で実行。</td>
            </tr>
            <tr>
              <td>void quadCrawler_Walk(uint16_t speed, uint8_t com);</td>
              <td>ロボット動作、指定した動作を継続する。<br />
              　speed - quadCrawler_xx<br />
              　com - stop, 他</td>
            </tr>
            <tr>
              <td>void quadCrawler_setSpeed(uint16_t speed);</td>
              <td>ロボット動作の速度を更新する。</td>
            </tr>
            <tr>
              <td>void quadCrawler_setPose1(<br />
              uint8_t index, uint8_t knee, uint8_t crach);</td>
              <td>指定した足の上下、前後の姿勢を設定する。<br />
              　index - FRONT_R, 他<br />
              　knee - POSE_xx<br />
              　crach - POSE_xx</td>
            </tr>
            <tr>
              <td>void quadCrawler_servoLoop(void);</td>
              <td>ロボット動作を経過時間に応じて更新する。<br />
              </td>
            </tr>
            <tr>
              <td>double quadCrawler_getSonner();</td>
              <td>超音波センサの値を取得する。</td>
            </tr>
            <tr>
              <td>void quadCrawler_beep(int time);</td>
              <td>ブザーを鳴らす。&#160;</td>
            </tr>
            <tr>
              <td>void quadCrawler_colorWipe(uint8_t color);</td>
              <td>LEDを指定した色にする。<br />
              　COLOR_xx</td>
            </tr>
            <tr>
              <td>void quadCrawler_rainbow(uint8_t wait);</td>
              <td>LEDを７色に光らせる。</td>
            </tr>
          </tbody>
        </table>
        </li>
        <li><a href="images/quadCrawlerRemocon.h">quadCrawlerRemocon.h</a><br />
        標準リモコンとアナログリモコンの受信処理<br />
        <table border="1">
          <tbody>
            <tr>
              <td>void remoconRobo_init(void);</td>
              <td>初期化処理、setup()で実行。&#160;</td>
            </tr>
            <tr>
              <td>int remoconRobo_checkRemoteUpdated(int mergeKeys);</td>
              <td>リモコン受信。&#160;mergeKeys=1のときxyKeysをkeysにコピーする。</td>
            </tr>
            <tr>
              <td>struct remoconData remoconRobo_getRemoteData(void);</td>
              <td>構造体 remoconDataを取得</td>
            </tr>
            <tr>
              <td>int remoconRobo_getRemoteX(void);</td>
              <td>remoconData.xを取得</td>
            </tr>
            <tr>
              <td>int remoconRobo_getRemoteY(void);</td>
              <td> remoconData.yを取得</td>
            </tr>
            <tr>
              <td>int remoconRobo_isRemoteKey(int key);</td>
              <td>取得したリモコンキーが key(BUTTON_xx) と一致するかチェック</td>
            </tr>
            <tr>
              <td>int remoconRobo_getRemoteKeys(void);</td>
              <td>remoconData.keys (BUTTON_xx) を取得</td>
            </tr>
            <tr>
              <td>int remoconRobo_checkRemoteKey(void);</td>
              <td>リモコン受信＋remoconData.keys (BUTTON_xx) を取得&#160;</td>
            </tr>
          </tbody>
        </table>
        </li>
      </ul>
    </div><!-- /#main -->
    <div id="hpb-aside">
      <div class="section">
        <h2 style="text-align : left;" align="left"><a href="usb2bt.html">USB2BT トップ</a></h2>
        <b>USB2BTplus</b>
        <ul>
          <li><a href="http://bit-trade-one.co.jp/product/module/usb2btp/">紹介(BitTradeOne)</a></li>
          <li><a href="usb2btp1_setup_j.html">セットアップ・使い方</a></li>
          <li><a href="usb2btp2_setup_mac_j.html">セットアップ(MAC OS)</a></li>
          <li><a href="usb2btp3_trouble_j.html">トラブル対応</a></li>
          <li><a href="usb2btp4_release_j.html">ダウンロード</a></li>
          <li><a href="usb2bt.html#supportContact">お問い合わせ先</a></li>
        </ul>
        <b>USB2BT</b>
        <ul>
          <li><a href="http://bit-trade-one.co.jp/product/assemblydisk/adu2b01/">紹介(BitTradeOne)</a> </li>
          <li><a href="usb2bt3_setup.html">セットアップ・使い方</a></li>
          <li><a href="usb2bt4_release.html">ダウンロード</a></li>
          <li><a href="usb2bt7_case.html">ケース作り方</a></li>
          <li><a href="usb2bt4_trouble.html">トラブル対応</a></li>
          <li><a href="usb2bt6_compatibility.html">動作確認済みリスト</a></li>
        </ul>
        <b>USB2BTブレッドボード版</b>
        <ul>
          <li><a href="usb2bt1_overall.html">紹介</a> </li>
          <li><a href="usb2bt2_hardware.html">作り方</a></li>
          <li><a href="usb2bt3_setup.html">セットアップ・使い方</a></li>
          <li><a href="usb2bt4_release.html">ダウンロード</a></li>
        </ul>
      </div>
      <!-- /.section -->
      <div class="section">
        <h2 style="text-align : left;" align="left"><a href="familyday.html">つくるっち トップ</a></h2>
        <ul>
          <li><a href="familyday_app.html">ダウンロード</a>&amp;説明</li>
        </ul>
        <b>リモコンロボ</b>
        <ul>
          <li><a href="familyday_manual.html">遊び方</a></li>
          <li><a href="familyday_instructions.html">作り方</a></li>
          <li><a href="familyday_program1.html">プログラミング</a></li>
          <li><a href="familyday_robot.html">リモコンロボ改造例</a></li>
        </ul>
        <b>その他</b>
        <ul>
          <li><a href="familyday_quadcrawler.html">クアッドクローラー</a></li>
          <li><a href="familyday_orgel.html">プログラミングオルゴール</a></li>
          <li><a href="familyday_shield.html">Arduinoシールド、他</a></li>
          <li><a href="familyday_extension.html">拡張ブロック作成</a></li>
        </ul>
      </div>
      <!-- /.section -->
      <div class="section">
        <h2 style="text-align : left;" align="left"><a href="bitclock.html">BitClock トップ</a></h2>
        <ul>
          <li><a href="http://bit-trade-one.co.jp/product/bitferrous/btclk/">製品情報(BitTradeOne)</a></li>
          <li><a href="bitclock_setup.html#app">設定アプリ ダウンロード</a></li>
          <li><a href="bitclock_setup.html">設定：基本/表示</a></li>
          <li><a href="bitclock_webinfo.html">設定：web情報表示</a></li>
          <li><a href="bitclock_weblogger.html">設定：アップロード</a></li>
          <li><a href="bitclock_camera.html">トレイルカメラ改造</a></li>
          <li><a href="bitclock_trouble.html">トラブル対応</a></li>
          <li>リリース情報・<a href="bitclock_dev.html">技術情報</a></li>
        </ul>
      </div>
      <!-- /.section -->
      <div class="section">
        <h2 style="text-align : left;" align="left"><a href="familyday_event.html">イベント出展</a></h2>
        <a href="familyday_event.html">イベント出展予定・実績</a>
      </div>
      <!-- /.section -->
      <div class="section">
        <ul>
          <li><a href="http://sohta02.bbs.fc2.com/">BBS</a></li>
        </ul>
      </div>
      <!-- /.section -->
      <div class="section">
        <ul>
          <li><a href="miscellaneous.html">スタッフ</a></li>
          <li><a href="miscellaneous.html#links">協力頂いた皆さま</a></li>
          <li><a href="http://www.nicovideo.jp/my/mylist/#/43985910">ニコ動</a></li>
          <li><a href="http://twitter.com/sohta02">twitter (ROM専)</a></li>
          <li><a href="oekaki.html">でんしおえかき</a></li>
        </ul>
      </div>
      <!-- /.section -->
    </div>
    <!-- /#hpb-aside -->
  </div><!-- /#contents -->
  <div id="hpb-footer">
    <div class="copyright">Copyright &#169; 2014-2019 sohta &amp; mei All Rights Reserved.</div>
  </div><!-- /#hpb-footer -->
</div><!-- /#top --></body>
</html>